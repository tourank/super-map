{
  "version": 3,
  "sources": ["../../../../../../Users/touran/super-map/netlify/functions/search-places.js"],
  "sourceRoot": "/var/folders/1b/dv0hpzms02s4xpryl9vx2_h00000gn/T/tmp-92814-m890WaCDeYB4",
  "sourcesContent": ["export const handler = async (event) => {\n  // Handle preflight OPTIONS request\n  if (event.httpMethod === 'OPTIONS') {\n    return {\n      statusCode: 200,\n      headers: {\n        'Access-Control-Allow-Origin': '*',\n        'Access-Control-Allow-Headers': 'Content-Type',\n        'Access-Control-Allow-Methods': 'POST, OPTIONS'\n      },\n      body: ''\n    };\n  }\n\n  console.log('Event method:', event.httpMethod);\n  console.log('Event body:', event.body);\n  console.log('Event headers:', event.headers);\n\n  if (!event.body) {\n    return {\n      statusCode: 400,\n      body: JSON.stringify({ error: 'Request body is required' }),\n    };\n  }\n\n  let parsedBody;\n  try {\n    parsedBody = JSON.parse(event.body);\n  } catch (error) {\n    return {\n      statusCode: 400,\n      body: JSON.stringify({ error: 'Invalid JSON in request body' }),\n    };\n  }\n\n  const { query, location } = parsedBody;\n\n  if (!process.env.GOOGLE_PLACES_API_KEY) {\n    return {\n      statusCode: 500,\n      body: JSON.stringify({ error: 'Google Places API key not configured' }),\n    };\n  }\n\n  try {\n    const requestBody = {\n      textQuery: query,\n      maxResultCount: 10\n    };\n\n    if (location && location.latitude && location.longitude) {\n      requestBody.locationBias = {\n        circle: {\n          center: {\n            latitude: location.latitude,\n            longitude: location.longitude\n          },\n          radius: 10000\n        }\n      };\n    }\n\n    console.log('Google API request body:', JSON.stringify(requestBody, null, 2));\n    console.log('Query value:', query);\n    console.log('Location value:', location);\n\n    const response = await fetch('https://places.googleapis.com/v1/places:searchText', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-Goog-Api-Key': process.env.GOOGLE_PLACES_API_KEY,\n        'X-Goog-FieldMask': 'places.id,places.displayName,places.formattedAddress,places.rating,places.priceLevel,places.types,places.location'\n      },\n      body: JSON.stringify(requestBody)\n    });\n\n    console.log('Google API response status:', response.status);\n    \n    const data = await response.json();\n    console.log('Google API response:', JSON.stringify(data, null, 2));\n\n    if (!response.ok) {\n      throw new Error(`Places API error: ${response.status}`);\n    }\n\n    return {\n      statusCode: 200,\n      headers: {\n        'Access-Control-Allow-Origin': '*',\n        'Access-Control-Allow-Headers': 'Content-Type',\n        'Access-Control-Allow-Methods': 'POST, OPTIONS'\n      },\n      body: JSON.stringify({ \n        results: data.places || [],\n        status: 'OK'\n      }),\n    };\n  } catch (error) {\n    console.error('Places API error:', error);\n    return {\n      statusCode: 500,\n      body: JSON.stringify({ error: error.message }),\n    };\n  }\n};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAO,IAAM,UAAU,OAAO,UAAU;AAEtC,MAAI,MAAM,eAAe,WAAW;AAClC,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,SAAS;AAAA,QACP,+BAA+B;AAAA,QAC/B,gCAAgC;AAAA,QAChC,gCAAgC;AAAA,MAClC;AAAA,MACA,MAAM;AAAA,IACR;AAAA,EACF;AAEA,UAAQ,IAAI,iBAAiB,MAAM,UAAU;AAC7C,UAAQ,IAAI,eAAe,MAAM,IAAI;AACrC,UAAQ,IAAI,kBAAkB,MAAM,OAAO;AAE3C,MAAI,CAAC,MAAM,MAAM;AACf,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,MAAM,KAAK,UAAU,EAAE,OAAO,2BAA2B,CAAC;AAAA,IAC5D;AAAA,EACF;AAEA,MAAI;AACJ,MAAI;AACF,iBAAa,KAAK,MAAM,MAAM,IAAI;AAAA,EACpC,SAAS,OAAO;AACd,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,MAAM,KAAK,UAAU,EAAE,OAAO,+BAA+B,CAAC;AAAA,IAChE;AAAA,EACF;AAEA,QAAM,EAAE,OAAO,SAAS,IAAI;AAE5B,MAAI,CAAC,QAAQ,IAAI,uBAAuB;AACtC,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,MAAM,KAAK,UAAU,EAAE,OAAO,uCAAuC,CAAC;AAAA,IACxE;AAAA,EACF;AAEA,MAAI;AACF,UAAM,cAAc;AAAA,MAClB,WAAW;AAAA,MACX,gBAAgB;AAAA,IAClB;AAEA,QAAI,YAAY,SAAS,YAAY,SAAS,WAAW;AACvD,kBAAY,eAAe;AAAA,QACzB,QAAQ;AAAA,UACN,QAAQ;AAAA,YACN,UAAU,SAAS;AAAA,YACnB,WAAW,SAAS;AAAA,UACtB;AAAA,UACA,QAAQ;AAAA,QACV;AAAA,MACF;AAAA,IACF;AAEA,YAAQ,IAAI,4BAA4B,KAAK,UAAU,aAAa,MAAM,CAAC,CAAC;AAC5E,YAAQ,IAAI,gBAAgB,KAAK;AACjC,YAAQ,IAAI,mBAAmB,QAAQ;AAEvC,UAAM,WAAW,MAAM,MAAM,sDAAsD;AAAA,MACjF,QAAQ;AAAA,MACR,SAAS;AAAA,QACP,gBAAgB;AAAA,QAChB,kBAAkB,QAAQ,IAAI;AAAA,QAC9B,oBAAoB;AAAA,MACtB;AAAA,MACA,MAAM,KAAK,UAAU,WAAW;AAAA,IAClC,CAAC;AAED,YAAQ,IAAI,+BAA+B,SAAS,MAAM;AAE1D,UAAM,OAAO,MAAM,SAAS,KAAK;AACjC,YAAQ,IAAI,wBAAwB,KAAK,UAAU,MAAM,MAAM,CAAC,CAAC;AAEjE,QAAI,CAAC,SAAS,IAAI;AAChB,YAAM,IAAI,MAAM,qBAAqB,SAAS,MAAM,EAAE;AAAA,IACxD;AAEA,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,SAAS;AAAA,QACP,+BAA+B;AAAA,QAC/B,gCAAgC;AAAA,QAChC,gCAAgC;AAAA,MAClC;AAAA,MACA,MAAM,KAAK,UAAU;AAAA,QACnB,SAAS,KAAK,UAAU,CAAC;AAAA,QACzB,QAAQ;AAAA,MACV,CAAC;AAAA,IACH;AAAA,EACF,SAAS,OAAO;AACd,YAAQ,MAAM,qBAAqB,KAAK;AACxC,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,MAAM,KAAK,UAAU,EAAE,OAAO,MAAM,QAAQ,CAAC;AAAA,IAC/C;AAAA,EACF;AACF;",
  "names": []
}
